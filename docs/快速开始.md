# 🚀 百度地图 API 快速开始指南

## 📋 目录

1. [验证集成](#1-验证集成)
2. [基础使用](#2-基础使用)
3. [常见场景](#3-常见场景)
4. [故障排查](#4-故障排查)

---

## 1. 验证集成

### 步骤 1：检查 API Key

打开 `index.html`，确认百度地图脚本已加载：

```html
<script type="text/javascript" src="https://api.map.baidu.com/api?v=3.0&ak=nsnFL3cWD3LiBc9MFnEADJlKU4ezNc6Y"></script>
```

### 步骤 2：启动项目

```bash
npm run dev
```

### 步骤 3：打开浏览器

访问 `http://localhost:5173`，查看视频监控墙模块。

### 步骤 4：验证功能

- ✅ 页面顶部显示小区标签（阳光小区、金地花园等）
- ✅ 没有出现 "百度地图 API 未加载" 错误
- ✅ 点击小区标签可以切换视频

如果显示 "⚠️ 错误信息"，说明 API 调用失败，系统已自动使用备用数据。

---

## 2. 基础使用

### 场景 A：在现有组件中使用

```vue
<template>
  <div>
    <button @click="loadData">加载小区</button>
    <ul>
      <li v-for="item in communities" :key="item.id">
        {{ item.name }} - {{ item.address }}
      </li>
    </ul>
  </div>
</template>

<script setup>
import { ref } from 'vue'
import { searchCommunities } from '@/services/baiduMapService'

const communities = ref([])

const loadData = async () => {
  try {
    communities.value = await searchCommunities({
      city: '定兴县',
      query: '小区',
      pageSize: 10
    })
  } catch (error) {
    console.error('加载失败', error)
  }
}
</script>
```

### 场景 B：修改搜索城市

打开 `src/components/VideoWall.vue`，找到 `loadCommunities` 函数：

```javascript
const loadCommunities = async () => {
  try {
    const result = await searchCommunities({
      city: '北京市',  // 👈 修改这里
      query: '小区',
      pageSize: 20
    })
    // ...
  } catch (err) {
    // ...
  }
}
```

### 场景 C：修改搜索关键词

```javascript
const result = await searchCommunities({
  city: '定兴县',
  query: '住宅',  // 👈 改为：小区、花园、公寓、住宅等
  pageSize: 20
})
```

---

## 3. 常见场景

### 🏘️ 场景 1：搜索指定城市的小区

```javascript
import { searchCommunities } from '@/services/baiduMapService'

// 搜索定兴县的小区
const result = await searchCommunities({
  city: '定兴县',
  query: '小区',
  pageSize: 20
})

console.log(`找到 ${result.length} 个小区`)
result.forEach(item => {
  console.log(`${item.name} - ${item.address}`)
})
```

### 📍 场景 2：搜索附近的小区

```javascript
import { searchNearbyCommunities } from '@/services/baiduMapService'

// 搜索指定坐标附近 5km 内的小区
const result = await searchNearbyCommunities({
  lng: 115.808,     // 经度
  lat: 39.267,      // 纬度
  radius: 5000,     // 半径（米）
  pageSize: 20
})

result.forEach(item => {
  console.log(`${item.name} - 距离：${item.distance}米`)
})
```

### 🗺️ 场景 3：地址转经纬度

```javascript
import { getLocationByAddress } from '@/services/baiduMapService'

const location = await getLocationByAddress('定兴县金台路88号', '定兴县')

console.log(`经度：${location.lng}`)
console.log(`纬度：${location.lat}`)
```

### 📌 场景 4：经纬度转地址

```javascript
import { getAddressByLocation } from '@/services/baiduMapService'

const addressInfo = await getAddressByLocation(115.808, 39.267)

console.log(`详细地址：${addressInfo.address}`)
console.log(`省份：${addressInfo.province}`)
console.log(`城市：${addressInfo.city}`)
```

### 📊 场景 5：获取小区详情

```javascript
import { getCommunityDetail } from '@/services/baiduMapService'

const detail = await getCommunityDetail('阳光小区', '定兴县')

console.log(`名称：${detail.name}`)
console.log(`地址：${detail.address}`)
console.log(`坐标：${detail.lng}, ${detail.lat}`)
```

---

## 4. 故障排查

### ❌ 问题 1：显示 "百度地图 API 未加载"

**原因：**
- 网络问题，无法加载百度地图脚本
- API Key 错误或失效

**解决方案：**

1. 检查网络连接
2. 打开浏览器控制台（F12），查看是否有错误信息
3. 验证 API Key：访问 https://lbsyun.baidu.com/
4. 尝试更换 API Key

```html
<!-- 在 index.html 中更换 -->
<script src="https://api.map.baidu.com/api?v=3.0&ak=你的新KEY"></script>
```

### ❌ 问题 2：搜索无结果

**原因：**
- 城市名称错误
- 关键词太具体
- 该地区数据不全

**解决方案：**

1. 检查城市名称是否正确（完整名称，如 "北京市" 而不是 "北京"）
2. 使用更宽泛的关键词

```javascript
// 尝试多个关键词
query: '小区'      // ✅ 推荐
query: '住宅'      // ✅ 推荐
query: '花园'      // ✅ 推荐
query: '阳光小区'   // ❌ 太具体，可能无结果
```

3. 扩大搜索范围

```javascript
// 使用附近搜索，扩大半径
radius: 10000  // 10公里
```

### ❌ 问题 3：自动使用备用数据

**显示：** "⚠️ 百度地图API未加载或搜索失败 - 已使用备用数据"

**原因：**
- API 请求失败（网络、Key等问题）
- 这是正常的容错机制

**解决方案：**

这不影响系统使用，但如果希望使用真实数据：

1. 打开浏览器控制台查看详细错误
2. 根据错误信息修复问题
3. 刷新页面重新加载

### ❌ 问题 4：CORS 错误

**错误信息：** `Access to fetch at '...' from origin '...' has been blocked by CORS policy`

**原因：**
- 百度地图 API 的跨域限制
- 需要配置域名白名单

**解决方案：**

1. 登录 [百度地图开放平台](https://lbsyun.baidu.com/)
2. 进入"控制台" > "应用管理"
3. 找到你的应用，点击"设置"
4. 在"IP白名单"或"域名白名单"中添加 `localhost` 或你的域名

### ❌ 问题 5：加载速度慢

**原因：**
- API 请求较多
- 网络延迟

**解决方案：**

1. 减少请求数量

```javascript
pageSize: 10  // 从 20 改为 10
```

2. 添加缓存机制（参考 `docs/百度地图API使用示例.js` 中的 `example8_SearchWithCache`）

3. 延迟加载

```javascript
// 等待页面其他内容加载完成后再加载小区数据
setTimeout(() => {
  loadCommunities()
}, 2000)  // 延迟 2 秒
```

---

## 📞 获取帮助

如果以上方法都无法解决问题：

1. **查看完整文档**：
   - [百度地图API集成说明.md](./百度地图API集成说明.md)
   - [百度地图API使用示例.js](./百度地图API使用示例.js)

2. **查看百度地图官方文档**：
   - [JavaScript API 文档](https://lbsyun.baidu.com/index.php?title=jspopular3.0)
   - [Place API 文档](https://lbsyun.baidu.com/index.php?title=jspopular3.0/guide/search)

3. **浏览器控制台调试**：
   - 按 F12 打开开发者工具
   - 查看 Console 标签页的错误信息
   - 查看 Network 标签页的网络请求

4. **社区求助**：
   - [百度地图开发者论坛](https://bbs.lbsyun.baidu.com/)
   - Stack Overflow

---

## ✅ 下一步

完成基础集成后，你可以：

1. ⭐ 自定义搜索参数（城市、关键词、数量）
2. ⭐ 添加缓存机制提升性能
3. ⭐ 集成到其他组件中
4. ⭐ 添加地图可视化展示
5. ⭐ 实现小区数据的增删改查

**祝你使用愉快！** 🎉

